<div class="panel" id="rasci-panel" data-panel-type="rasci">
  <div class="panel-header">
    <div class="panel-title">
      <i class="fas fa-table"></i>
      <span>Matriz RASCI</span>
    </div>
    <div class="panel-actions">
      <button class="panel-btn" title="Ocultar"><i class="fas fa-eye-slash"></i></button>
      <button class="panel-btn" title="Solo este panel"><i class="fas fa-expand"></i></button>
    </div>
  </div>

  <div class="panel-tabs">
    <div class="tab active" data-tab="main" onclick="cambiarPestana('main')">Matriz</div>
    <div class="tab" data-tab="config" onclick="cambiarPestana('config')">Leyenda</div>
    <div class="tab" data-tab="mapping" onclick="cambiarPestana('mapping')">Mapeo RALph</div>
  </div>

  <div class="panel-content">
    <div id="main-tab" class="tab-content active">
      <button class="btn btn-primary btn-full-width" onclick="reloadRasciMatrix()">
        <i class="fas fa-sync-alt"></i> Recargar Matriz
      </button>
      <div id="matrix-container"></div>
    </div>

    <div id="config-tab" class="tab-content" style="display: none;">
      <div class="rasci-legend">
        <div class="legend-header">
          <h3 class="legend-title">Matriz RACI - Gu√≠a de Responsabilidades</h3>
          <p class="legend-subtitle">&emsp;Asigna claramente las responsabilidades para cada tarea del proceso</p>
        </div>
        
        <div class="legend-item r">
          <span class="legend-color r">R</span>
          <div class="legend-content">
            <div class="legend-name">Responsable (Responsible)</div>
            <div class="legend-description">Persona que ejecuta y realiza la tarea. Es quien hace el trabajo necesario para completar la actividad.</div>
          </div>
        </div>
        
        <div class="legend-item a">
          <span class="legend-color a">A</span>
          <div class="legend-content">
            <div class="legend-name">Aprobador (Accountable)</div>
            <div class="legend-description">Persona que rinde cuentas del resultado. Aprueba o rechaza el trabajo y es el responsable final del √©xito.</div>
          </div>
        </div>
        
        <div class="legend-item s">
          <span class="legend-color s">S</span>
          <div class="legend-content">
            <div class="legend-name">Soporte (Support)</div>
            <div class="legend-description">Persona que proporciona recursos, herramientas o asistencia necesaria para completar la tarea.</div>
          </div>
        </div>
        
        <div class="legend-item c">
          <span class="legend-color c">C</span>
          <div class="legend-content">
            <div class="legend-name">Consultado (Consulted)</div>
            <div class="legend-description">Persona cuya opini√≥n se busca antes de tomar decisiones. Proporciona input y expertise.</div>
          </div>
        </div>
        
        <div class="legend-item i">
          <span class="legend-color i">I</span>
          <div class="legend-content">
            <div class="legend-name">Informado (Informed)</div>
            <div class="legend-description">Persona que debe ser notificada sobre las decisiones y avances, pero no participa activamente.</div>
          </div>
        </div>
      </div>
    </div>

    <div id="mapping-tab" class="tab-content" style="display: none;">
      <div class="mapping-container">
        <div class="mapping-header">
          <h3 class="mapping-title">Mapeo Autom√°tico RASCI ‚Üí RALph</h3>
          <p class="mapping-subtitle">Convierte autom√°ticamente la matriz RASCI en elementos RALph sobre el diagrama BPMN</p>
        </div>
        
        <div class="mapping-controls">
          <button class="btn btn-primary btn-full-width" onclick="executeRasciToRalphMapping()">
            <i class="fas fa-magic"></i> Ejecutar Mapeo Autom√°tico
          </button>
          <button class="btn btn-success btn-full-width" onclick="executeIntelligentRasciMapping()" style="margin-top: 10px;">
            <i class="fas fa-brain"></i> Mapeo Inteligente (Detecta Cambios)
          </button>
        </div>
        
        <div class="mapping-info" style="margin-top: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 5px; font-size: 0.9em;">
          <h5 style="margin: 0 0 8px 0; color: #495057;">üí° Tipos de Mapeo:</h5>
          <div style="margin-bottom: 8px;">
            <strong>üîµ Mapeo Autom√°tico:</strong> Crea elementos nuevos sin eliminar los existentes. Ideal para la primera ejecuci√≥n.
          </div>
          <div style="margin-bottom: 8px;">
            <strong>üü¢ Mapeo Inteligente:</strong> <strong>NUEVO:</strong> Borra todos los elementos RALph existentes y los recrea desde cero seg√∫n la matriz RASCI actual. Garantiza sincronizaci√≥n perfecta.
          </div>
          <div style="margin-top: 10px; padding: 8px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;">
            <strong>‚ö†Ô∏è Nota:</strong> El mapeo autom√°tico al escribir est√° <strong>desactivado</strong>. Ahora solo se ejecuta cuando presionas los botones manualmente.
          </div>
          <div style="margin-top: 10px; padding: 8px; background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px;">
            <strong>üîÑ Recreaci√≥n Completa:</strong> En cada ejecuci√≥n, el sistema elimina todos los elementos RALph existentes y los recrea desde cero, garantizando que el diagrama est√© siempre sincronizado con la matriz RASCI.
          </div>
          <div style="margin-top: 10px; padding: 8px; background-color: #e8f5e8; border: 1px solid #c3e6cb; border-radius: 4px;">
            <strong>üìç Preservaci√≥n Inteligente de Posiciones:</strong> El sistema analiza la matriz RASCI actual y solo mantiene las posiciones de elementos que siguen existiendo. Los elementos eliminados de la matriz se recrean en nuevas posiciones calculadas. <strong>Las puertas AND y roles SIEMPRE preservan sus posiciones exactas con verificaci√≥n adicional.</strong>
          </div>
          
          <div style="margin-top: 10px; padding: 8px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;">
            <strong>üîß Herramienta de Diagn√≥stico:</strong> Si tienes problemas con roles que no generan flechas (como el rol "gfh"), usa el archivo <code>test-gfh-role.html</code> para diagnosticar y forzar conexiones manualmente.
          </div>
        </div>

        <div class="mapping-results" id="mapping-results" style="display: none;">
          <h4>Resultado del Mapeo</h4>
          <div id="mapping-log"></div>
        </div>

        <div class="mapping-legend">
          <h4>L√≥gica de Mapeo</h4>
          <div class="mapping-rule">
            <span class="rule-letter r">R</span>
            <div class="rule-content">
              <strong>Responsable:</strong> Una flecha directa del rol a la tarea (ROL ‚Üí TAREA)
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter a">A</span>
            <div class="rule-content">
              <strong>Aprobador:</strong> Tarea intermedia "Aprobar [X]" entre la tarea actual y la siguiente
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter s">S</span>
            <div class="rule-content">
              <strong>Soporte:</strong> Ambos roles (R + S) van al nodo AND, y el AND va a la tarea
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter c">C</span>
            <div class="rule-content">
              <strong>Consultado:</strong> Nodo de consulta con flujo bidireccional (pregunta ‚Üî respuesta)
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter i">I</span>
            <div class="rule-content">
              <strong>Informado:</strong> Evento intermedio que env√≠a notificaci√≥n al rol
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


</div>
