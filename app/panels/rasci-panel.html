<div class="panel" id="rasci-panel" data-panel-type="rasci">
  <div class="panel-header">
    <div class="panel-title">
      <i class="fas fa-table"></i>
      <span>Matriz RASCI</span>
    </div>
    <div class="panel-actions">
      <button class="panel-btn" title="Ocultar"><i class="fas fa-eye-slash"></i></button>
      <button class="panel-btn" title="Solo este panel"><i class="fas fa-expand"></i></button>
    </div>
  </div>

  <div class="panel-tabs">
    <div class="tab active" data-tab="main" onclick="cambiarPestana('main')">Matriz</div>
    <div class="tab" data-tab="config" onclick="cambiarPestana('config')">Leyenda</div>
    <div class="tab" data-tab="mapping" onclick="cambiarPestana('mapping')">Mapeo RALph</div>
  </div>

  <div class="panel-content">
    <div id="main-tab" class="tab-content active">
      <button class="btn btn-primary btn-full-width" onclick="reloadRasciMatrix()">
        <i class="fas fa-sync-alt"></i> Recargar Matriz
      </button>
      <div id="matrix-container"></div>
    </div>

    <div id="config-tab" class="tab-content" style="display: none;">
      <div class="rasci-legend">
        <div class="legend-header">
          <h3 class="legend-title">Matriz RACI - Gu√≠a de Responsabilidades</h3>
          <p class="legend-subtitle">&emsp;Asigna claramente las responsabilidades para cada tarea del proceso</p>
        </div>
        
        <div class="legend-item r">
          <span class="legend-color r">R</span>
          <div class="legend-content">
            <div class="legend-name">Responsable (Responsible)</div>
            <div class="legend-description">Persona que ejecuta y realiza la tarea. Es quien hace el trabajo necesario para completar la actividad.</div>
          </div>
        </div>
        
        <div class="legend-item a">
          <span class="legend-color a">A</span>
          <div class="legend-content">
            <div class="legend-name">Aprobador (Accountable)</div>
            <div class="legend-description">Persona que rinde cuentas del resultado. Aprueba o rechaza el trabajo y es el responsable final del √©xito.</div>
          </div>
        </div>
        
        <div class="legend-item s">
          <span class="legend-color s">S</span>
          <div class="legend-content">
            <div class="legend-name">Soporte (Support)</div>
            <div class="legend-description">Persona que proporciona recursos, herramientas o asistencia necesaria para completar la tarea.</div>
          </div>
        </div>
        
        <div class="legend-item c">
          <span class="legend-color c">C</span>
          <div class="legend-content">
            <div class="legend-name">Consultado (Consulted)</div>
            <div class="legend-description">Persona cuya opini√≥n se busca antes de tomar decisiones. Proporciona input y expertise.</div>
          </div>
        </div>
        
        <div class="legend-item i">
          <span class="legend-color i">I</span>
          <div class="legend-content">
            <div class="legend-name">Informado (Informed)</div>
            <div class="legend-description">Persona que debe ser notificada sobre las decisiones y avances, pero no participa activamente.</div>
          </div>
        </div>
      </div>
    </div>

    <div id="mapping-tab" class="tab-content" style="display: none;">
      <div class="mapping-container">
        <div class="mapping-header">
          <h3 class="mapping-title">Mapeo Autom√°tico RASCI ‚Üí RALph</h3>
          <p class="mapping-subtitle">Convierte autom√°ticamente la matriz RASCI en elementos RALph sobre el diagrama BPMN</p>
        </div>
        
        <div class="mapping-controls">
          <button class="btn btn-primary btn-full-width" onclick="executeRasciToRalphMapping()">
            <i class="fas fa-magic"></i> Ejecutar Mapeo Autom√°tico
          </button>
          
          <button class="btn btn-secondary btn-full-width" onclick="autoMapTasksToDiagram()" style="margin-top: 10px;">
            <i class="fas fa-link"></i> Mapear Tareas a Diagrama
          </button>
          
          <button class="btn btn-danger btn-full-width" onclick="clearRalphElements()" style="margin-top: 10px;">
            <i class="fas fa-trash"></i> Limpiar Elementos RALph
          </button>
          
          <button class="btn btn-warning btn-full-width" onclick="cleanupRalphConnections()" style="margin-top: 10px;">
            <i class="fas fa-broom"></i> Limpiar Conexiones Problem√°ticas
          </button>
          
          <button class="btn btn-success btn-full-width" onclick="optimizeRalphDiagram()" style="margin-top: 10px;">
            <i class="fas fa-magic"></i> Optimizar Todo el Diagrama RALph
          </button>
          
          <button class="btn btn-info btn-full-width" onclick="enableAutoReposition()" style="margin-top: 10px;">
            <i class="fas fa-sync-alt"></i> Activar Reposicionamiento Autom√°tico
          </button>
          
          <button class="btn btn-outline-info btn-full-width" onclick="disableAutoReposition()" style="margin-top: 10px;">
            <i class="fas fa-stop"></i> Desactivar Reposicionamiento Autom√°tico
          </button>
          
          <div class="mapping-options">
            <label class="mapping-option">
              <input type="checkbox" id="create-approval-tasks" checked>
              <span>Crear tareas de aprobaci√≥n (A)</span>
            </label>
            <label class="mapping-option">
              <input type="checkbox" id="create-message-flows" checked>
              <span>Crear flujos de mensaje (C/I)</span>
            </label>
            <label class="mapping-option">
              <input type="checkbox" id="create-capabilities" checked>
              <span>Crear capacidades para roles inexistentes (S)</span>
            </label>
          </div>

          <div class="positioning-options">
            <h4>üéØ Sistema de Posicionamiento Simple y Claro</h4>
            <div class="positioning-info">
              <p><strong>Sistema simple estilo BPMN nativo:</strong></p>
              <ul>
                <li>‚úÖ Posicionamiento natural: derecha, arriba, abajo, izquierda</li>
                <li>‚úÖ Evita elementos duplicados cerca de la misma tarea</li>
                <li>‚úÖ Conexiones rectas y simples</li>
                <li>‚úÖ Tareas de aprobaci√≥n insertadas en el flujo</li>
                <li>‚úÖ Espaciado compacto y ordenado</li>
                <li>‚úÖ Posiciones alternativas cuando el espacio est√° ocupado</li>
                <li>‚úÖ Reposicionamiento autom√°tico al mover tareas</li>
                <li>‚úÖ Sin complejidad innecesaria</li>
                <li>‚úÖ Claridad visual m√°xima</li>
              </ul>
            </div>
            
            <div class="positioning-grid">
              <div class="positioning-item">
                <label>Espaciado m√≠nimo:</label>
                <input type="number" id="spacing" value="80" min="50" max="200">
              </div>
              <div class="positioning-item">
                <label>Radio de b√∫squeda:</label>
                <input type="number" id="search-radius" value="200" min="100" max="500">
              </div>
            </div>
            
            <button class="btn btn-secondary btn-full-width" onclick="applyPositioningConfig()" style="margin-top: 10px;">
              <i class="fas fa-cog"></i> Aplicar Configuraci√≥n
            </button>
            
                      <button class="btn btn-info btn-full-width" onclick="showExistingElementsStats()" style="margin-top: 10px;">
            <i class="fas fa-chart-bar"></i> Ver Estad√≠sticas Existentes
          </button>
          
          <button class="btn btn-danger btn-full-width" onclick="resetPositioning()" style="margin-top: 10px;">
            <i class="fas fa-undo"></i> Resetear Posicionamiento
          </button>
          
          <button class="btn btn-warning btn-full-width" onclick="cleanDuplicateRoles()" style="margin-top: 10px;">
            <i class="fas fa-filter"></i> Limpiar Roles Duplicados
          </button>
          
          <button class="btn btn-info btn-full-width" onclick="showPositioningStatus()" style="margin-top: 10px;">
            <i class="fas fa-info-circle"></i> Estado del Posicionamiento
          </button>
          </div>
        </div>

        <div class="mapping-results" id="mapping-results" style="display: none;">
          <h4>Resultado del Mapeo</h4>
          <div id="mapping-log"></div>
        </div>

        <div class="mapping-legend">
          <h4>L√≥gica de Mapeo Mejorada</h4>
          <div class="mapping-rule">
            <span class="rule-letter r">R</span>
            <div class="rule-content">
              <strong>Responsable:</strong> Asignaci√≥n directa del rol a la tarea (l√≠nea s√≥lida)
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter a">A</span>
            <div class="rule-content">
              <strong>Aprobador:</strong> Nueva tarea "Aprobar [X]" insertada en el flujo del proceso
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter s">S</span>
            <div class="rule-content">
              <strong>Soporte:</strong> Nodo AND que conecta responsable + soporte (colaboraci√≥n)
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter c">C</span>
            <div class="rule-content">
              <strong>Consultado:</strong> Nodo de consulta con flujo bidireccional (pregunta ‚Üî respuesta)
            </div>
          </div>
          <div class="mapping-rule">
            <span class="rule-letter i">I</span>
            <div class="rule-content">
              <strong>Informado:</strong> Evento intermedio que env√≠a notificaci√≥n al rol
            </div>
          </div>
          
          <div class="mapping-note">
            <h5>üí° Notas sobre las Relaciones:</h5>
            <ul>
              <li><strong>R + S:</strong> Se crea autom√°ticamente un nodo AND que conecta ambos roles</li>
              <li><strong>C:</strong> Se representa como un flujo bidireccional con nodo intermedio</li>
              <li><strong>A:</strong> Se inserta en el flujo del proceso, no como elemento separado</li>
              <li><strong>I:</strong> Se representa como evento de notificaci√≥n unidireccional</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>


</div>
